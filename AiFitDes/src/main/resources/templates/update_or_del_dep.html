<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta charset="UTF-8">
		<title>修改/删除部门</title>
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
		<script src="/jquery/jquery-3.3.1.min.js"></script>
		<link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="/bootstrap/css/bootstrap-theme.min.css">
		<script src="/bootstrap/js/bootstrap.min.js"></script>
		<style>
		    body {
		        margin-top: 50px;
		    }
		    .footer {
			    border-top: 2px solid #e5e5e5;
			    color: #777;
			    padding: 15px 0;
			    background-color: #f5f5f5;
			}
			.panel {
			    margin-left: 5%;
			    margin-right: 5%;
			}
		</style>
	</head>
	<body>
		<!-- 头部导航栏开始 -->
		<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				    </button>
					<a class="navbar-brand" href="#">Zhgy</a>
				</div>
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon-th"></span>&nbsp;&nbsp;部门管理
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
							    <li><a href="/alldep">查看所有部门</a></li>
								<li role="separator" class="divider"></li>
								<li><a href="/adddep">添加部门</a></li>
								<li role="separator" class="divider"></li>
								<li class="active"><a href="/uoddep">修改/删除部门</a></li>
							</ul>
						</li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
								<span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;员工管理 
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
							    <li><a href="/allemp">查看所有员工</a></li>
								<li role="separator" class="divider"></li>
								<li><a href="/addemp">添加员工</a></li>
								<li role="separator" class="divider"></li>
								<li><a href="/uodemp">修改/删除员工</a></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		<!-- 头部导航栏结束 -->
		
		<!-- 导航条 -->
		<ol class="breadcrumb">
		    <li><a href="#">部门管理</a></li>
		    <li class="active">修改/删除部门</li>
		</ol>
		<!-- 导航条结束 -->
		
		<!-- 内容表格 -->
		<div class="panel panel-default">
			<div class="panel-heading">修改/删除部门</div>
			<div class="panel-body">
			    <p>这里提供对部门的修改删除方法</p>
			</div>
			<table class="table table-striped">
			    <tr>
			        <th>部门ID</th>
			        <th>部门名称</th>
			        <th>部门负责人</th>
			        <th>部门员工数量</th>
			        <th>操作</th>
			    </tr>
			    <#list alldep as c>
				<tr>
					<td>${c.id}</td>
					<td>${c.name}</td>
					<td>${c.employee.name}</td>
					<td>${c.employees?size}</td>
					<td>
						<a type="button" class="btn btn-info" data-toggle="modal" href="javascript:updateById(${c.id}, '${c.name}');">修改</a>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<a type="button" class="btn btn-danger" data-toggle="modal" href="javascript:deleteById(${c.id}, '${c.name}');">删除</a>
					</td>
				</tr>
				</#list>
			</table>
			<hr />
			<center>
				<nav aria-label="Page navigation">
				  <ul class="pagination">
				    <li>
				      <a href="#" aria-label="Previous">
				        <span aria-hidden="true">&laquo;</span>
				      </a>
				    </li>
				    <li class="active"><a href="#">1</a></li>
				    <li><a href="#">2</a></li>
				    <li><a href="#">3</a></li>
				    <li><a href="#">4</a></li>
				    <li><a href="#">5</a></li>
				    <li>
				      <a href="#" aria-label="Next">
				        <span aria-hidden="true">&raquo;</span>
				      </a>
				    </li>
				  </ul>
				</nav>
			</center>
		</div>
		
		<!-- 页脚开始 -->
		<div class="footer">
		    <div class="container">
		        <div class="row footer-bottom">
		            <ul class="list-inline text-center">
		                <li>Zhgy 2018.6.5 - Software All Rights Reserved.</li>
		            </ul>
		        </div>
		    </div>
		</div>
		<!-- 页脚结束 -->
		
		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		    <div class="modal-dialog" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		                <h4 class="modal-title" id="myModalLabel">更改部门信息</h4>
		            </div>
		            <div class="modal-body">
		                <div class="container-fluid">
		                    <div class="row">
		                    	<div class="col-xs-12">
		                    		<h5 id="reset_head">为部门重命名或重设负责人</h5>
		                    	</div>
		                    </div>
					        <div class="row">
					            <div class="col-xs-8">
							    	<div class="input-group">
									    <span class="input-group-addon">重命名部门名称</span>
									    <input id="depId" type="text" class="form-control">
									</div>
								</div>
								<div class="col-xs-4">
									<div style="width: 50%;" class="btn-group">
										<button id="head_emp" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										    重置部门负责人
										    <span class="caret"></span>
										</button>
										<ul id="head_emp_ul" class="dropdown-menu">
										    <#list allemp as c>
										        <li><a href="#">${c.name}</a></li>
											</#list>
										</ul>
										<script>
										    $(function(){
										        var list = document.getElementById("head_emp_ul");
												for(var i=1; i<list.childNodes.length; i++){
												    list.childNodes[i].onclick = function(){
													    document.getElementById('head_emp').innerText = this.innerText;
												    }
												}
										    });
										</script>
								    </div>
								</div>
							</div>
						</div>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
		                <a type="button" class="btn btn-primary" href="javascript:startupdate();">保存更改</a>
		            </div>
		        </div>
		    </div>
		</div>
		
		<!-- Modal -->
		<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		    <div class="modal-dialog" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		                <h4 class="modal-title" id="myModalLabel">确认删除部门?</h4>
		            </div>
		            <div id="deleteName" class="modal-body">
		              您确认删除部门
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
		                <a href="javascript: startdelete();" type="button" class="btn btn-primary">确认删除</a>
		            </div>
		        </div>
		    </div>
		</div>
		
		<!-- Modal -->
		<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		    <div class="modal-dialog" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		                <h4 class="modal-title" id="myModalLabel">删除情况反馈</h4>
		            </div>
		            <div id="deleteName1" class="modal-body"></div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
		            </div>
		        </div>
		    </div>
		</div>
		
		<script>
		    var delId = null;
		    var updateId = null;
		    
		    function updateById(id, name){
		        updateId = id;
		        document.getElementById('reset_head').innerText = "为部门 "+name+" 重命名或重设负责人";
		        $('#myModal').modal();
		    }
		    
		    function startupdate(){
		        var head_name = document.getElementById('head_emp').innerText.replace(/\s+/g, "");
		        var name = $('#depId').val().replace(" ", "");
		        $('#myModal').modal('hide');
		        jQuery.ajax({
			        url: "/dep/update",
			        data:{
			        	"id": updateId,
			        	"name": name,
			        	"head_name": head_name
			        },
			        type: 'POST',
			        success: function (response) {
			            document.getElementById('deleteName1').innerText = response;
			            document.getElementById('myModalLabel').innerText = "修改情况反馈";
			            $('#myModal2').modal();
			        }
		        });
		    }
		
		    function deleteById(id, name){
		        delId = id;
		        document.getElementById('deleteName').innerText = "您确认删除部门 "+name+" 吗？";
		        $('#myModal1').modal();
		    }
		    
		    function startdelete(){
		        $('#myModal1').modal('hide');
		    	jQuery.ajax({
			        url: "/dep/delete",
			        data:{
			        	"id": delId
			        },
			        type: 'POST',
			        success: function (response) {
			            document.getElementById('deleteName1').innerText = response;
			            document.getElementById('myModalLabel').innerText = "删除情况反馈";
			            $('#myModal2').modal();
			        }
		        });
		    }
		    
		    $('#myModal2').on('hidden.bs.modal', function (event) {
			    location.reload();
			})
		</script>
	</body>
</html>

